# 🎯 新闻评分功能 - 使用教程

> 将"三问评分法"集成到TrendRadar项目中，自动筛选高质量新闻素材

---

## 📌 功能说明

### 什么是评分功能？

评分功能基于**三大黄金法则**（受众广度 + 切身利益 + 理解简单），对每条新闻进行0-30分的评分，自动过滤低质量素材。

### 评分标准

| 维度 | 满分 | 评判标准 |
|------|------|---------|
| **受众广度** | 10分 | 覆盖人群越广，分数越高 |
| **切身利益** | 10分 | 与资金需求关联越直接，分数越高 |
| **易理解度** | 10分 | 专业术语越少，分数越高 |

### 评分等级

| 分数范围 | 评级 | 使用建议 |
|---------|------|---------|
| 27-30分 | ⭐⭐⭐⭐⭐ 完美 | ✅ 立即使用 |
| 23-26分 | ⭐⭐⭐⭐ 优质 | ✅ 推荐使用 |
| 18-22分 | ⭐⭐⭐ 一般 | ⚠️ 谨慎使用 |
| 12-17分 | ⭐⭐ 勉强 | ⚠️ 需要改写 |
| 0-11分 | ⭐ 不推荐 | ❌ 直接放弃 |

---

## 🚀 快速开始（3种使用方式）

### 方式1：独立评分工具（推荐新手）

**适用场景**：手动筛选新闻，不修改原项目

#### 步骤1：测试评分功能

```bash
cd /Users/dzsb-002295/Desktop/JY/CY/TrendRadar

# 运行测试，查看评分效果
python news_scorer.py
```

#### 步骤2：评分自己的新闻

创建测试脚本 `test_my_news.py`：

```python
from news_scorer import score_single_news

# 你的新闻标题
my_news = [
    "多地房租价格上涨，年轻人租房压力大",
    "央行宣布下调LPR利率",
    "90后小伙靠摆摊月入过万",
]

print("=" * 60)
print("我的新闻评分结果")
print("=" * 60)

for i, title in enumerate(my_news, 1):
    score, details, rating, suggestion = score_single_news(title)
    
    print(f"\n{i}. {title}")
    print(f"   总分：{score}/30")
    print(f"   详情：受众{details['受众广度']} + 利益{details['切身利益']} + 理解{details['易理解度']}")
    print(f"   评级：{rating}")
    print(f"   建议：{suggestion}")
```

运行：
```bash
python test_my_news.py
```

---

### 方式2：批量评分TXT文件（推荐日常使用）

**适用场景**：对已收集的新闻批量评分

#### 创建批量评分脚本

创建 `batch_score.py`：

```python
#!/usr/bin/env python
# coding=utf-8
"""批量评分TXT文件中的新闻"""

import sys
from news_scorer import batch_score_news

def score_txt_file(txt_path, min_score=18):
    """
    评分TXT文件中的新闻
    
    Args:
        txt_path: TXT文件路径
        min_score: 最低分数阈值
    """
    print(f"\n正在评分文件：{txt_path}")
    print(f"最低分数阈值：{min_score}分\n")
    
    # 读取文件
    try:
        with open(txt_path, 'r', encoding='utf-8') as f:
            lines = f.readlines()
    except Exception as e:
        print(f"❌ 读取文件失败：{e}")
        return
    
    # 提取新闻标题（简单解析）
    titles = []
    for line in lines:
        line = line.strip()
        # 跳过空行和分隔线
        if not line or line.startswith('━') or line.startswith('='):
            continue
        # 跳过明显不是标题的行
        if line.startswith('📊') or line.startswith('🔥') or line.startswith('更新时间'):
            continue
        # 简单提取：如果包含中文且长度适中
        if any('\u4e00' <= c <= '\u9fff' for c in line) and 5 < len(line) < 100:
            # 移除序号、平台标签等
            title = line
            # 移除 "1. [平台名] " 这样的前缀
            import re
            title = re.sub(r'^\d+\.\s*', '', title)
            title = re.sub(r'^\[.*?\]\s*', '', title)
            title = re.sub(r'^🆕\s*', '', title)
            title = re.sub(r'\s*\[.*?\]\s*-.*$', '', title)
            
            if title.strip():
                titles.append(title.strip())
    
    if not titles:
        print("❌ 未找到有效的新闻标题")
        return
    
    print(f"✅ 共找到 {len(titles)} 条新闻\n")
    
    # 批量评分
    results = batch_score_news(titles, min_score=min_score)
    
    if not results:
        print(f"❌ 没有新闻达到 {min_score} 分以上")
        return
    
    print("=" * 80)
    print(f"【评分结果】（共 {len(results)} 条达标新闻，已按分数排序）")
    print("=" * 80)
    
    for i, news in enumerate(results, 1):
        score = news['score']
        details = news['score_details']
        rating = news['rating_label']
        suggestion = news['usage_suggestion']
        title = news['title']
        
        print(f"\n{i}. {title}")
        print(f"   总分：{score}/30")
        print(f"   详情：受众{details['受众广度']} + 利益{details['切身利益']} + 理解{details['易理解度']}")
        print(f"   评级：{rating}")
        print(f"   建议：{suggestion}")
    
    print("\n" + "=" * 80)
    print(f"✅ 评分完成！建议使用 23分以上 的新闻")
    print("=" * 80)

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print("用法：python batch_score.py <txt文件路径> [最低分数]")
        print("示例：python batch_score.py output/2025年12月06日/txt/10时30分.txt 20")
        sys.exit(1)
    
    txt_path = sys.argv[1]
    min_score = int(sys.argv[2]) if len(sys.argv) > 2 else 18
    
    score_txt_file(txt_path, min_score)
```

#### 使用方法

```bash
# 评分某天的新闻（最低18分）
python batch_score.py output/2025年12月06日/txt/10时30分.txt

# 评分并设置更高标准（最低25分，只要完美素材）
python batch_score.py output/2025年12月06日/txt/10时30分.txt 25
```

---

### 方式3：集成到项目（高级用户）

**适用场景**：自动评分并过滤，修改原项目流程

#### 步骤1：启用评分功能

编辑 `config/config.yaml`：

```yaml
report:
  mode: "daily"
  rank_threshold: 5
  
  # 🎯 启用评分功能
  enable_scoring: true      # 改为 true
  min_score: 23             # 只保留23分以上的新闻
  show_score_in_report: true  # 在报告中显示评分
```

#### 步骤2：修改main.py集成评分

在 `main.py` 中找到 `count_word_frequency` 函数，在匹配新闻后添加评分逻辑：

```python
# 在文件开头导入评分模块
from news_scorer import NewsScorer

# 在 load_config() 函数中加载评分配置
def load_config():
    # ... 现有代码 ...
    
    # 评分功能配置
    config["ENABLE_SCORING"] = config_data["report"].get("enable_scoring", False)
    config["MIN_SCORE"] = config_data["report"].get("min_score", 18)
    config["SHOW_SCORE_IN_REPORT"] = config_data["report"].get("show_score_in_report", False)
    
    return config

# 在 count_word_frequency 函数中添加评分逻辑
def count_word_frequency(...):
    # ... 现有代码 ...
    
    # 初始化评分器（如果启用）
    scorer = None
    if CONFIG.get("ENABLE_SCORING", False):
        scorer = NewsScorer({'min_score': CONFIG.get("MIN_SCORE", 18)})
        print(f"✅ 评分功能已启用，最低分数：{CONFIG.get('MIN_SCORE', 18)}分")
    
    # 在处理每条新闻时
    for title, title_data in titles_data.items():
        # ... 现有的匹配逻辑 ...
        
        # 如果匹配成功，进行评分
        if matches_word_groups(title, word_groups, filter_words):
            # 评分过滤
            if scorer:
                score, details = scorer.score_news(title)
                if not scorer.should_keep(score):
                    print(f"  ⚠️ 评分过低({score}分)，已过滤：{title[:30]}...")
                    continue  # 跳过低分新闻
                
                # 保存评分信息到title_data
                title_data['score'] = score
                title_data['score_details'] = details
            
            # ... 继续处理匹配的新闻 ...
```

#### 步骤3：在输出中显示评分

修改生成报告的函数，在标题后显示评分：

```python
# 在生成报告时
def generate_report(...):
    # ... 现有代码 ...
    
    for title, data in sorted_titles:
        # 获取评分信息
        score = data.get('score', 0)
        score_text = ""
        if CONFIG.get("SHOW_SCORE_IN_REPORT", False) and score > 0:
            rating = get_rating_label(score)
            score_text = f" [{score}分 {rating}]"
        
        # 输出标题时添加评分
        output += f"{index}. {title}{score_text}\n"
```

---

## 📊 实战示例

### 示例1：快速评分单条新闻

```python
from news_scorer import score_single_news

title = "多地房租价格上涨，年轻人租房压力大"
score, details, rating, suggestion = score_single_news(title)

print(f"标题：{title}")
print(f"总分：{score}/30")
print(f"评级：{rating}")
print(f"建议：{suggestion}")
```

输出：
```
标题：多地房租价格上涨，年轻人租房压力大
总分：30/30
评级：⭐⭐⭐⭐⭐ 完美
建议：✅ 立即使用
```

### 示例2：批量评分并排序

```python
from news_scorer import batch_score_news

titles = [
    "多地房租价格上涨，年轻人租房压力大",
    "央行宣布下调LPR利率",
    "90后小伙靠摆摊月入过万",
]

results = batch_score_news(titles, min_score=20)

for news in results:
    print(f"{news['title']} - {news['score']}分 - {news['usage_suggestion']}")
```

输出：
```
多地房租价格上涨，年轻人租房压力大 - 30分 - ✅ 立即使用
90后小伙靠摆摊月入过万 - 27分 - ✅ 立即使用
```

### 示例3：自定义评分标准

```python
from news_scorer import NewsScorer

# 自定义配置：更严格的标准
custom_config = {
    'min_score': 25,  # 只要25分以上的
}

scorer = NewsScorer(custom_config)

title = "90后小伙靠摆摊月入过万"
score, details = scorer.score_news(title)

if scorer.should_keep(score):
    print(f"✅ 保留：{title} ({score}分)")
else:
    print(f"❌ 过滤：{title} ({score}分)")
```

---

## 🎯 推荐工作流程

### 每日使用流程

```
1. 早上运行项目收集新闻
   ↓
2. 使用 batch_score.py 评分当天的TXT文件
   ↓
3. 只使用 23分以上 的新闻创作脚本
   ↓
4. 记录高转化案例，持续优化评分标准
```

### 完整命令示例

```bash
# 第1步：运行项目收集新闻
python main.py

# 第2步：评分今天的新闻（设置25分标准）
python batch_score.py output/2025年12月06日/txt/09时30分.txt 25

# 第3步：使用评分结果创作脚本
# （手动筛选25分以上的新闻）
```

---

## 💡 使用技巧

### 技巧1：找到最佳分数线

建议测试不同的分数标准：

```bash
# 测试 18分标准（宽松）
python batch_score.py your_news.txt 18

# 测试 23分标准（推荐）
python batch_score.py your_news.txt 23

# 测试 25分标准（严格）
python batch_score.py your_news.txt 25
```

根据实际转化效果，选择最佳标准。

### 技巧2：建立高分素材库

创建文件夹保存高分新闻：

```bash
mkdir high_score_news

# 手动将高分新闻复制到此文件夹
# 形成自己的"黄金素材库"
```

### 技巧3：定期复盘

每周统计：
- 使用了多少条新闻
- 各分数段的转化率
- 是否需要调整评分标准

---

## ⚙️ 高级配置

### 自定义关键词权重

编辑 `news_scorer.py`，修改关键词列表：

```python
class NewsScorer:
    def __init__(self, config: Dict = None):
        # 添加你自己发现的高转化关键词
        self.high_audience_keywords = [
            '工资', '薪资', '裁员',  # 原有的
            '你的新关键词',           # 新增的
        ]
```

### 调整评分权重

如果发现某个维度更重要，可以调整权重：

```python
def score_news(self, title: str):
    # 原来是 1:1:1
    audience_score = self._score_audience(title_lower) * 1.5  # 提高受众权重
    interest_score = self._score_interest(title_lower) * 1.0
    understanding_score = self._score_understanding(title_lower) * 0.5
    
    total_score = audience_score + interest_score + understanding_score
```

---

## ❓ 常见问题

### Q1：评分功能会影响原项目吗？

**A**：不会。`news_scorer.py` 是独立模块，不修改原项目任何文件。

### Q2：我应该用哪种方式？

**A**：
- **新手**：方式1（独立工具）
- **日常使用**：方式2（批量评分）
- **深度集成**：方式3（修改项目）

### Q3：评分不准怎么办？

**A**：
1. 记录实际转化数据
2. 调整 `news_scorer.py` 中的关键词
3. 修改评分权重
4. 持续优化

### Q4：能否导出评分结果？

**A**：可以修改 `batch_score.py`添加导出功能：

```python
import json

# 保存为JSON
with open('score_results.json', 'w', encoding='utf-8') as f:
    json.dump(results, f, ensure_ascii=False, indent=2)
```

---

## 🎉 开始使用

**推荐新手开始步骤**：

```bash
# 第1步：测试评分功能
python news_scorer.py

# 第2步：创建批量评分脚本
# （复制上面的 batch_score.py 代码）

# 第3步：评分你的新闻
python batch_score.py output/某天/txt/某时.txt 23

# 第4步：只用23分以上的新闻创作脚本
```

祝您找到更多高转化的新闻素材！🚀

---

**更新时间**：2025-12-06  
**适用版本**：TrendRadar v3.4.1+  
**评分标准**：三问评分法（受众+利益+理解）

